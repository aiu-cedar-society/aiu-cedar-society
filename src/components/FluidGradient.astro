---
interface Props {
  className?: string;
}

const { className = "" } = Astro.props;
---

<!-- 
  Simplified background for better Speed Index
  Decorative elements are deferred to after LCP
-->
<div class={`warm-background ${className}`} data-warm-bg>
  <!-- Static gradient only - no animations initially -->
</div>

<style>
  .warm-background {
    position: absolute;
    inset: 0;
    overflow: hidden;
    /* Simple static gradient for instant render */
    background: linear-gradient(
      135deg,
      var(--bg-gradient-start, #fef9f4) 0%,
      var(--bg-secondary, #faf7f2) 35%,
      var(--bg-gradient-end, #f0ede8) 100%
    );
    /* CSS containment for better performance */
    contain: strict;
  }

  /* Decorative elements - added via JS after LCP */
  .warm-bg-blob {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0;
    pointer-events: none;
    /* Only animate after page is interactive */
    transition: opacity 1s ease-out;
  }

  .warm-background.loaded .warm-bg-blob {
    opacity: 0.4;
    animation: warm-blob-float 20s ease-in-out infinite;
  }

  .warm-bg-blob-1 {
    width: 600px;
    height: 600px;
    background: radial-gradient(
      circle,
      rgba(255, 235, 205, 0.6) 0%,
      rgba(255, 235, 205, 0) 70%
    );
    top: -200px;
    left: -200px;
  }

  .warm-bg-blob-2 {
    width: 500px;
    height: 500px;
    background: radial-gradient(
      circle,
      rgba(230, 240, 230, 0.5) 0%,
      rgba(230, 240, 230, 0) 70%
    );
    top: 20%;
    right: -150px;
    animation-delay: 5s;
  }

  @keyframes warm-blob-float {
    0%, 100% { transform: translate(0, 0) scale(1); }
    50% { transform: translate(20px, 20px) scale(1.05); }
  }

  /* アクセシビリティ */
  @media (prefers-reduced-motion: reduce) {
    .warm-bg-blob {
      animation: none !important;
    }
  }
</style>

<script>
  // Defer decorative elements until after LCP
  function initWarmBackground() {
    const bg = document.querySelector('[data-warm-bg]');
    if (!bg) return;
    
    // Add decorative blobs after page is interactive
    const blob1 = document.createElement('div');
    blob1.className = 'warm-bg-blob warm-bg-blob-1';
    const blob2 = document.createElement('div');
    blob2.className = 'warm-bg-blob warm-bg-blob-2';
    
    bg.appendChild(blob1);
    bg.appendChild(blob2);
    
    // Trigger animation after a small delay
    requestAnimationFrame(() => {
      bg.classList.add('loaded');
    });
  }
  
  // Initialize after LCP (use requestIdleCallback if available)
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      if ('requestIdleCallback' in window) {
        requestIdleCallback(initWarmBackground, { timeout: 3000 });
      } else {
        setTimeout(initWarmBackground, 2000);
      }
    });
  } else {
    if ('requestIdleCallback' in window) {
      requestIdleCallback(initWarmBackground, { timeout: 3000 });
    } else {
      setTimeout(initWarmBackground, 2000);
    }
  }
  
  // Support Astro page transitions
  document.addEventListener('astro:page-load', () => {
    if ('requestIdleCallback' in window) {
      requestIdleCallback(initWarmBackground, { timeout: 3000 });
    } else {
      setTimeout(initWarmBackground, 2000);
    }
  });
</script>
