---
interface BreadcrumbItem {
    label: string;
    href?: string; // 最後のアイテムはリンクなし
}

interface Props {
    items: BreadcrumbItem[];
}

const { items } = Astro.props;

// ホームアイテムかどうかを判定
const isHomeItem = (item: BreadcrumbItem, index: number) => {
    return (
        index === 0 &&
        (item.label === "ホーム" || item.label === "Home" || item.href === "/")
    );
};
---

<nav aria-label="パンくずリスト" class="breadcrumb-nav">
    <ol
        class="breadcrumb-list"
        itemscope
        itemtype="https://schema.org/BreadcrumbList"
    >
        {
            items.map((item, index) => {
                const isHome = isHomeItem(item, index);
                const isLast = index === items.length - 1;

                return (
                    <li
                        class="breadcrumb-item"
                        itemprop="itemListElement"
                        itemscope
                        itemtype="https://schema.org/ListItem"
                    >
                        {item.href ? (
                            <a
                                href={item.href}
                                class="breadcrumb-link"
                                itemprop="item"
                            >
                                {isHome && (
                                    <svg
                                        class="breadcrumb-home-icon"
                                        fill="none"
                                        viewBox="0 0 24 24"
                                        stroke="currentColor"
                                        aria-hidden="true"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                                        />
                                    </svg>
                                )}
                                <span itemprop="name">{item.label}</span>
                            </a>
                        ) : (
                            <span
                                class="breadcrumb-current"
                                aria-current="page"
                                itemprop="name"
                            >
                                {item.label}
                            </span>
                            <link itemprop="item" href={new URL(Astro.url.pathname, Astro.site || "https://aiu-cedar-society.com").href} />
                        )}
                        <meta itemprop="position" content={String(index + 1)} />
                        {!isLast && (
                            <svg
                                class="breadcrumb-separator"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke="currentColor"
                                aria-hidden="true"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M9 5l7 7-7 7"
                                />
                            </svg>
                        )}
                    </li>
                );
            })
        }
    </ol>
</nav>

<style>
    .breadcrumb-nav {
        margin-bottom: var(--space-6, 1.5rem);
        padding: var(--space-2, 0.5rem) 0;
    }

    .breadcrumb-list {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 0.5rem;
        list-style: none;
        padding: 0;
        margin: 0;
        font-size: 0.875rem;
        line-height: 1.5;
    }

    .breadcrumb-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* リンクスタイル */
    .breadcrumb-link {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.375rem 0.625rem;
        border-radius: 0.5rem;
        color: #4b5563; /* Gray-600 for better contrast */
        text-decoration: none;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 500;
        position: relative;
    }

    .breadcrumb-link:hover {
        color: #006837;
        background-color: rgba(0, 104, 55, 0.08);
        transform: translateY(-1px);
    }

    .breadcrumb-link:active {
        transform: translateY(0);
    }

    /* Global focus style will apply, but we ensure radius matches */
    .breadcrumb-link:focus-visible {
        border-radius: 0.5rem;
    }

    /* ホームアイコン */
    .breadcrumb-home-icon {
        width: 1.125rem; /* Slightly larger */
        height: 1.125rem;
        flex-shrink: 0;
        transition: transform 0.2s ease;
    }

    .breadcrumb-link:hover .breadcrumb-home-icon {
        transform: scale(1.1);
    }

    /* 現在位置（最後のアイテム） */
    .breadcrumb-current {
        display: inline-flex;
        align-items: center;
        padding: 0.375rem 0.75rem;
        border-radius: 0.5rem;
        color: #111827;
        font-weight: 600;
        background-color: rgba(0, 104, 55, 0.05); /* Softer background */
        border: 1px solid rgba(0, 104, 55, 0.15);
        position: relative;
    }

    /* セパレーター（矢印） */
    .breadcrumb-separator {
        width: 1rem;
        height: 1rem;
        color: #9ca3af; /* Gray-400 for better visibility */
        flex-shrink: 0;
        transition: color 0.2s ease;
    }

    .breadcrumb-item:hover .breadcrumb-separator {
        color: #6b7280;
    }

    /* モバイル対応 */
    @media (max-width: 640px) {
        .breadcrumb-list {
            font-size: 0.8125rem;
            gap: 0.375rem;
        }

        .breadcrumb-link,
        .breadcrumb-current {
            padding: 0.25rem 0.5rem;
            font-size: 0.8125rem;
        }

        .breadcrumb-separator {
            width: 0.875rem;
            height: 0.875rem;
        }

        .breadcrumb-home-icon {
            width: 1rem;
            height: 1rem;
        }

        /* 長いパンくずリストの場合、最初と最後だけ表示 */
        .breadcrumb-list:has(> :nth-child(5))
            .breadcrumb-item:not(:first-child):not(:last-child) {
            display: none;
        }

        .breadcrumb-list:has(> :nth-child(5))::before {
            content: "...";
            color: #9ca3af;
            padding: 0 0.25rem;
        }
    }

    /* ダークモード対応 */
    [data-theme="dark"] .breadcrumb-link {
        color: #9ca3af;
    }

    [data-theme="dark"] .breadcrumb-link:hover {
        color: #32d74b;
        background-color: rgba(50, 215, 75, 0.15);
    }

    [data-theme="dark"] .breadcrumb-current {
        color: #ffffff;
        background-color: rgba(50, 215, 75, 0.2);
        border-color: rgba(50, 215, 75, 0.3);
    }

    [data-theme="dark"] .breadcrumb-separator {
        color: #6b7280;
    }

    [data-theme="dark"] .breadcrumb-item:hover .breadcrumb-separator {
        color: #9ca3af;
    }

    /* アニメーション */
    @keyframes breadcrumb-fade-in {
        from {
            opacity: 0;
            transform: translateY(-4px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .breadcrumb-item {
        animation: breadcrumb-fade-in 0.3s ease-out backwards;
    }

    .breadcrumb-item:nth-child(1) {
        animation-delay: 0s;
    }
    .breadcrumb-item:nth-child(2) {
        animation-delay: 0.05s;
    }
    .breadcrumb-item:nth-child(3) {
        animation-delay: 0.1s;
    }
    .breadcrumb-item:nth-child(4) {
        animation-delay: 0.15s;
    }
    .breadcrumb-item:nth-child(5) {
        animation-delay: 0.2s;
    }

    /* アニメーション無効化（アクセシビリティ） */
    @media (prefers-reduced-motion: reduce) {
        .breadcrumb-item {
            animation: none;
        }

        .breadcrumb-link {
            transition: color 0.15s ease;
        }

        .breadcrumb-link:hover {
            transform: none;
        }
    }

    /* タッチデバイスでの最適化 */
    @media (hover: none) and (pointer: coarse) {
        .breadcrumb-link {
            min-height: 44px;
            min-width: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .breadcrumb-link:hover {
            transform: none;
        }
    }
</style>
