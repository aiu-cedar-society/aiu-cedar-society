---
/**
 * AnimatedIcon - Rive animation for section icons
 * Displays an animated icon that responds to hover/interaction
 */
import RiveAnimation from "./RiveAnimation.astro";

interface Props {
  riveSrc?: string;
  fallbackIcon?: string;
  className?: string;
  size?: "sm" | "md" | "lg";
  hoverAnimation?: boolean;
}

const { 
  riveSrc = "",
  fallbackIcon = "",
  className = "",
  size = "md",
  hoverAnimation = true
} = Astro.props;

const sizeClasses = {
  sm: "w-4 h-4",
  md: "w-6 h-6",
  lg: "w-8 h-8"
};
---

<div 
  class={`animated-icon animated-icon-${size} ${className}`}
  data-hover-animation={hoverAnimation}
>
  {riveSrc ? (
    <RiveAnimation 
      src={riveSrc}
      className="animated-icon-rive"
      autoplay={true}
    />
  ) : (
    <!-- Fallback SVG when Rive file is not provided -->
    <div class="animated-icon-fallback" set:html={fallbackIcon}></div>
  )}
</div>

<style>
  .animated-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease;
  }

  .animated-icon-sm {
    width: 1rem;
    height: 1rem;
    min-width: 1rem;
  }

  .animated-icon-md {
    width: 1.5rem;
    height: 1.5rem;
    min-width: 1.5rem;
  }

  .animated-icon-lg {
    width: 2rem;
    height: 2rem;
    min-width: 2rem;
  }

  .animated-icon-rive {
    width: 100%;
    height: 100%;
    min-height: auto;
  }

  .animated-icon-fallback {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .animated-icon-fallback svg {
    width: 100%;
    height: 100%;
  }

  /* Hover animation */
  [data-hover-animation="true"]:hover {
    transform: scale(1.1);
  }

  @media (prefers-reduced-motion: reduce) {
    .animated-icon {
      transition: none;
    }
    
    [data-hover-animation="true"]:hover {
      transform: none;
    }
  }
</style>

<script>
  // Add hover state machine trigger if Rive is available
  if (typeof window !== "undefined" && hoverAnimation) {
    document.addEventListener("DOMContentLoaded", () => {
      const icons = document.querySelectorAll(".animated-icon[data-hover-animation='true']");
      
      icons.forEach((icon) => {
        const riveContainer = icon.querySelector(".rive-container");
        if (!riveContainer) return;
        
        const riveInstance = (riveContainer as any).__riveInstance;
        if (!riveInstance) return;
        
        icon.addEventListener("mouseenter", () => {
          // Trigger hover state if state machine is available
          try {
            if (riveInstance.stateMachineInputs && riveInstance.stateMachineInputs.length > 0) {
              const hoverInput = riveInstance.stateMachineInputs.find(
                (input: any) => input.name === "hover" || input.name === "Hover"
              );
              if (hoverInput) {
                hoverInput.value = true;
              }
            }
          } catch (e) {
            // Silently fail if state machine is not available
          }
        });
        
        icon.addEventListener("mouseleave", () => {
          try {
            if (riveInstance.stateMachineInputs && riveInstance.stateMachineInputs.length > 0) {
              const hoverInput = riveInstance.stateMachineInputs.find(
                (input: any) => input.name === "hover" || input.name === "Hover"
              );
              if (hoverInput) {
                hoverInput.value = false;
              }
            }
          } catch (e) {
            // Silently fail if state machine is not available
          }
        });
      });
    });
  }
</script>
