---
import { getLangFromUrl, getAlternateUrl } from '../i18n/utils';

interface Props {
  title?: string;
  description?: string;
  keywords?: string;
  ogImage?: string;
  ogType?: 'website' | 'article';
  article?: {
    publishedTime?: string;
    author?: string;
  };
}

const {
  title = 'AIU Cedar Society - 秋田とAIU生の可能性をつなぐ',
  description = 'AIU Cedar Societyは、秋田国際教養大学の学生主導の公認団体です。著名なゲストを招いた講演会を通じて、学生と秋田社会をつなぎ、「出会い・学び・実践」のサイクルを創り出します。',
  keywords = 'AIU Cedar Society,秋田国際教養大学,学生団体,講演会,AIU,秋田,イベント,キャリア支援,地域活性化',
  ogImage = '/ogp-default.jpg',
  ogType = 'website',
  article,
} = Astro.props;

// サイト情報
const siteUrl = Astro.site || 'https://aiu-cedar-society.com';
const siteName = 'AIU Cedar Society';
const currentLang = getLangFromUrl(Astro.url);
const currentPath = Astro.url.pathname;

// Ensure trailing slash consistency for canonical URL
const normalizedPath = currentPath.endsWith('/') ? currentPath : currentPath + '/';
const currentUrl = new URL(normalizedPath, siteUrl).href;

// 代替言語URLを生成
const alternateLang = currentLang === 'ja' ? 'en' : 'ja';
const alternatePath = getAlternateUrl(Astro.url, alternateLang);
const alternateUrl = new URL(alternatePath, siteUrl).href;

// 画像の絶対URL
const ogImageUrl = ogImage.startsWith('http') ? ogImage : new URL(ogImage, siteUrl).href;
---

<!-- Primary Meta Tags -->
<title>{title}</title>
<meta name="title" content={title} />
<meta name="description" content={description} />
<meta name="keywords" content={keywords} />
<link rel="canonical" href={currentUrl} />

<!-- hreflang tags for multilingual support -->
<link rel="alternate" hreflang={currentLang} href={currentUrl} />
<link rel="alternate" hreflang={alternateLang} href={alternateUrl} />
<link rel="alternate" hreflang="x-default" href={new URL('/', siteUrl).href} />

<!-- Open Graph / Facebook -->
<meta property="og:type" content={ogType} />
<meta property="og:url" content={currentUrl} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={ogImageUrl} />
<meta property="og:site_name" content={siteName} />
<meta property="og:locale" content={currentLang === 'ja' ? 'ja_JP' : 'en_US'} />

{article && ogType === 'article' && (
  <>
    {article.publishedTime && <meta property="article:published_time" content={article.publishedTime} />}
    {article.author && <meta property="article:author" content={article.author} />}
  </>
)}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content={currentUrl} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={ogImageUrl} />

<!-- Additional SEO -->
<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
<meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
<meta name="author" content={siteName} />
<meta name="geo.region" content="JP-05" />
<meta name="geo.placename" content="秋田市" />